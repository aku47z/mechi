---
import { codes } from "../scripts/codes.ts";
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import Button from "../components/Button.astro";
import Success from "../components/Success.astro";
import { Image } from "astro:assets";
import alpine from "../assets/Request/alpine.png";
import canyon from "../assets/Request/canyon.png";
import dune from "../assets/Request/dune.png";
import festive from "../assets/Request/festive.png";
import marina from "../assets/Request/marina.png";
import yosemite from "../assets/Request/yosemite.png";

const images = [
  { src: festive, alt: "Festive" },
  { src: dune, alt: "Dune" },
  { src: marina, alt: "Marina" },
  { src: canyon, alt: "Canyon" },
  { src: yosemite, alt: "Yosemite" },
  { src: alpine, alt: "Alpine" },
];
---

<Layout
  title="Request A Sample"
  description="Choose a sample from one our finest Tibetan Rugs. All our rugs are fully customizable in shape size and color."
>
  <Navbar />
  <div id="req-form">
    <h3>EXPERIENCE THE QUALITY FIRSTHAND: REQUEST A SAMPLE</h3>
    <p>All our rugs are fully customizable in shape size and color.</p>
    <form action="https://api.web3forms.com/submit" method="POST" id="form">
      <div id="input-container">
        <input
          type="hidden"
          name="access_key"
          value={import.meta.env.PUBLIC_API_KEY}
        />
        <input type="hidden" name="from_name" value="Mechicarpet.com" />
        <input
          type="hidden"
          name="subject"
          value="New Sample Request from your Website"
        />

        <!-- Name -->
        <div class="form-group">
          <label for="name">Name</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            placeholder="Your Name"
          />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="you@example.com"
          />
        </div>

        <div class="form-group">
          <label for="phone">Phone Number</label>
          <div class="phone-group">
            <select name="Country Code" id="countryCode" required>
              {
                codes.map((code) => (
                  <option value={`+${code.countryCodes}`}>
                    {code.isoCode3} +{code.countryCodes}
                  </option>
                ))
              }
            </select>
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              placeholder="Phone no."
            />
          </div>
        </div>

        <!-- Message -->
        <div class="form-group">
          <label for="message">Message</label>
          <textarea
            id="message"
            name="message"
            rows="6"
            maxlength="500"
            required
            placeholder="Your message (max 500 characters)"></textarea>
          <p class="help-text">Maximum 500 characters.</p>
        </div>

        <input
          type="checkbox"
          name="botcheck"
          class="hidden"
          style="display: none;"
        />

        <div id="buttons">
          <button type="submit">
            Submit
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="54"
              height="55"
              viewBox="0 0 49 48"
              fill="none"
            >
              <circle cx="24.5" cy="24" r="23.5" stroke="#000"></circle>
              <path
                d="M31.8646 17.636C31.8646 17.0837 31.4169 16.636 30.8646 16.636L21.8646 16.636C21.3124 16.636 20.8646 17.0837 20.8646 17.636C20.8646 18.1883 21.3124 18.636 21.8646 18.636L29.8646 18.636L29.8646 26.636C29.8646 27.1883 30.3124 27.636 30.8646 27.636C31.4169 27.636 31.8646 27.1883 31.8646 26.636L31.8646 17.636ZM18.8438 31.0711L31.5717 18.3431L30.1575 16.9289L17.4296 29.6568L18.8438 31.0711Z"
                fill="#000"></path>
            </svg>
          </button>
          <Button link="/product" text="Back to Product" color="#1b1b1c" />
        </div>
      </div>

      <div id="sample-images">
        <p id="choose-sample">Choose the sample</p>
        <div class="image-grid">
          {
            images.map((image) => (
              <div class="image-option">
                <input
                  type="radio"
                  name="Chosen Sample"
                  value={image.alt}
                  id={image.alt}
                  required
                />
                <label for={image.alt}>
                  <Image src={image.src} alt={image.alt} />
                  <span>{image.alt}</span>
                </label>
              </div>
            ))
          }
        </div>
      </div>
    </form>
    <Success />
  </div>
</Layout>

<style>
  #req-form {
    border-top: 1px solid rgba(0, 0, 0, 0.7);
    width: 100%;
    padding: 8rem 5rem;
  }

  h3 {
    max-width: 50rem;
    margin-bottom: 1.5rem;
  }

  form {
    margin-top: 4.5rem;
    display: flex;
    gap: 3rem;
    justify-content: space-between;
    align-items: flex-start;
  }

  #input-container {
    margin-top: 2rem;
    max-width: 36rem;
    display: flex;
    flex: 1;
    flex-direction: column;
    gap: 1.5rem;
  }

  label {
    display: block;
    color: #414651;
    font-family: "General Sans", sans-serif;
    font-size: 1rem;
    font-style: normal;
    font-weight: 500;
    line-height: 1.25rem;
    padding-bottom: 0.5rem;
  }

  input,
  select,
  textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    gap: 0.5rem;
    align-self: stretch;
    border-radius: 0.5rem;
    border: 1px solid var(--Gray-300, #d5d7da);
    background: var(--White, #fff);
    box-shadow: 0px 1px 2px 0px rgba(10, 13, 18, 0.05);
    font-family: "General Sans", sans-serif;
    font-size: 1rem;
    font-style: normal;
    font-weight: 400;
    line-height: 1.5rem;
    color: #717680;
  }

  textarea {
    resize: none;
  }

  .phone-group {
    display: flex;
  }
  .phone-group select {
    width: 30%;
    margin-right: 5px;
  }
  .phone-group input {
    width: 70%;
  }

  button {
    background-color: #f6f6f6;
    border-radius: 5rem;
    border: 1px solid #bababa;
    width: fit-content;
    height: fit-content;
    display: flex;
    padding: 0.825rem 0.875rem 1rem 1.625rem;
    justify-content: center;
    align-items: center;
    gap: 1.125rem;
    cursor: pointer;
    /* text style */
    color: #1b1b1c;
    font-family: "General Sans", sans-serif;
    font-size: 1.125rem;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
    letter-spacing: 0.005rem;
    text-decoration: none;
  }
  .help-text {
    font-size: 0.75em;
    color: #666;
  }

  #buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  #sample-images {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3.5rem;
  }

  #choose-sample {
    color: #656569;
    font-family: "General Sans", sans-serif;
    font-size: 1rem;
    font-style: normal;
    font-weight: 400;
    line-height: 120%; /* 1.2rem */
    letter-spacing: 0.005rem;
  }

  .image-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 3.5rem;
  }
  .image-option {
    position: relative;
    max-width: 250px;
    min-width: 150px;
  }
  .image-option input[type="radio"] {
    position: absolute;
    opacity: 0;
    bottom: 0;
    width: 1px;
    height: 1px;
    pointer-events: none;
  }
  .image-option label {
    cursor: pointer;
    display: block;
    text-align: left;
  }
  .image-option img {
    width: 100%;
    height: auto;
    border-radius: 4px;
    border: 8px solid transparent;
    transition: border 0.3s;
  }
  .image-option label img:hover {
    border: 2px solid transparent;
  }
  .image-option input[type="radio"]:checked + label img {
    border: 4px solid black;
  }
  .image-option span {
    display: block;
    margin-top: 0.5rem;
    padding-left: 0.5rem;
  }

  @media screen and (max-width: 768px) {
    form {
      max-width: 100%;
      flex-direction: column;
    }

    h3 {
      font-size: 2.5rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("form");
    const modal = document.getElementById("modal");

    form?.addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);

      fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: json,
      })
        .then(async (response) => {
          let json = await response.json();
          if (response.status == 200) {
            modal?.classList.add("open");
          }
        })
        .catch((error) => {
          console.log(error);
        })
        .then(function () {
          form.reset();
          modal?.addEventListener("click", (event) => {
            if (event.target === modal) {
              modal.classList.remove("open");
            }
          });
        });
    });

    const sampleRadios = document.querySelectorAll(
      'input[name="Chosen Sample"]'
    );

    sampleRadios.forEach((radio) => {
      // When any radio changes, clear the custom validity on all radios
      radio.addEventListener("change", () => {
        sampleRadios.forEach((r) => r.setCustomValidity(""));
      });

      // When a radio is invalid (e.g. when the form is submitted with none selected),
      // set the custom validity message on that radio
      radio.addEventListener("invalid", function (e) {
        e.target.setCustomValidity("Please select a sample");
      });
    });
  });
</script>
